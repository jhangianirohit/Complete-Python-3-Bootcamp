<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FX Volatility P&L Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f7;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0 0 10px 0;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .results-box {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background: #f5f5f5;
        }
        .pnl-positive {
            color: #28a745;
            font-weight: 600;
        }
        .pnl-negative {
            color: #dc3545;
            font-weight: 600;
        }
        .big-number {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #5568d3;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ FX Volatility Trading P&L Demo</h1>
        <p>Complete Working Example - No Setup Required!</p>
    </div>

    <div class="info-box">
        <strong>üì± This is a complete demo with sample data already loaded.</strong><br>
        Just scroll down to see the P&L calculation results for buying a EURUSD call option and delta-hedging it.
    </div>

    <div class="results-box">
        <h2>Trade Setup</h2>
        <div class="summary-grid">
            <div class="summary-card">
                <div class="label">Currency Pair</div>
                <div class="big-number">EURUSD</div>
            </div>
            <div class="summary-card">
                <div class="label">Initial Spot</div>
                <div class="big-number">1.1000</div>
            </div>
            <div class="summary-card">
                <div class="label">Strike (ATM)</div>
                <div class="big-number">1.1000</div>
            </div>
            <div class="summary-card">
                <div class="label">Implied Vol</div>
                <div class="big-number">10.0%</div>
            </div>
        </div>
    </div>

    <div class="results-box" id="resultsContainer">
        <h2>üìä P&L Results</h2>
        <div id="calculationResults">
            <p>Calculating...</p>
        </div>
    </div>

    <div class="results-box">
        <h2>üìñ What This Shows</h2>
        <p><strong>This demo calculates the P&L from:</strong></p>
        <ul>
            <li><strong>Buying</strong> a 24-hour EURUSD call option at-the-money (strike 1.1000)</li>
            <li><strong>Delta-hedging</strong> the option every 10 minutes over 24 hours</li>
            <li><strong>Comparing</strong> the realized volatility vs the implied volatility you paid for</li>
        </ul>

        <h3>Key P&L Components:</h3>
        <ul>
            <li><strong>Premium Paid:</strong> What you paid upfront to buy the option</li>
            <li><strong>Hedge P&L:</strong> Profit/loss from delta-hedging the option</li>
            <li><strong>Intrinsic Value:</strong> Final payoff of the option at expiry</li>
            <li><strong>Total P&L:</strong> = -Premium + Hedge P&L + Intrinsic Value</li>
        </ul>

        <h3>Why P&L Matters More Than Vol:</h3>
        <p>Even if realized volatility is higher than implied, you can lose money if the spot moves away from the strike (low gamma region). P&L captures this effect!</p>
    </div>

    <div class="results-box">
        <h2>üíæ Want to Use Your Own Data?</h2>
        <p>To analyze your own FX data:</p>
        <ol>
            <li>Download the full tool from the GitHub repository</li>
            <li>Prepare your data in CSV format (spot prices and implied vols)</li>
            <li>Use the offline version (fx_volatility_analytics_offline.html)</li>
        </ol>
        <button class="btn" onclick="window.location.href='https://github.com/jhangianirohit/Complete-Python-3-Bootcamp'">
            View on GitHub
        </button>
    </div>

    <script>
        // Sample data embedded in the file
        const spotData = [
            1.1000, 1.0995, 1.1000, 1.1001, 1.0994, 1.0999, 1.1003, 1.0997, 1.1005, 1.1002,
            1.1008, 1.1004, 1.1010, 1.1007, 1.1012, 1.1009, 1.1015, 1.1011, 1.1018, 1.1014,
            1.1020, 1.1017, 1.1022, 1.1019, 1.1025, 1.1021, 1.1028, 1.1024, 1.1030, 1.1026,
            1.1032, 1.1029, 1.1025, 1.1021, 1.1018, 1.1014, 1.1011, 1.1007, 1.1004, 1.1000,
            1.0997, 1.0993, 1.0990, 1.0987, 1.0984, 1.0981, 1.0978, 1.0975, 1.0972, 1.0970,
            1.0973, 1.0976, 1.0980, 1.0983, 1.0987, 1.0990, 1.0994, 1.0997, 1.1001, 1.1004,
            1.1008, 1.1011, 1.1015, 1.1018, 1.1021, 1.1024, 1.1027, 1.1030, 1.1033, 1.1030,
            1.1027, 1.1024, 1.1021, 1.1018, 1.1015, 1.1012, 1.1009, 1.1006, 1.1003, 1.1000,
            1.0998, 1.0995, 1.0993, 1.0990, 1.0988, 1.0985, 1.0983, 1.0980, 1.0978, 1.0980,
            1.0983, 1.0986, 1.0989, 1.0992, 1.0995, 1.0998, 1.1001, 1.1004, 1.1007, 1.1010,
            1.1012, 1.1014, 1.1016, 1.1018, 1.1020, 1.1022, 1.1024, 1.1026, 1.1028, 1.1030,
            1.1028, 1.1026, 1.1024, 1.1022, 1.1020, 1.1018, 1.1016, 1.1014, 1.1012, 1.1010,
            1.1008, 1.1006, 1.1004, 1.1002, 1.1000, 1.0998, 1.0996, 1.0994, 1.0992, 1.0990,
            1.0992, 1.0994, 1.0997, 1.0999, 1.1002, 1.1004, 1.1007, 1.1009, 1.1012, 1.1014,
            1.1017, 1.1019, 1.1022, 1.1024, 1.1027
        ];

        // Black-Scholes functions
        function normalCDF(x) {
            const t = 1 / (1 + 0.2316419 * Math.abs(x));
            const d = 0.3989423 * Math.exp(-x * x / 2);
            const prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            return x > 0 ? 1 - prob : prob;
        }

        function blackScholesCall(S, K, T, sigma) {
            if (T <= 0) {
                return {
                    price: Math.max(S - K, 0),
                    delta: S > K ? 1 : 0
                };
            }

            const d1 = (Math.log(S / K) + 0.5 * sigma * sigma * T) / (sigma * Math.sqrt(T));
            const d2 = d1 - sigma * Math.sqrt(T);
            const price = S * normalCDF(d1) - K * normalCDF(d2);
            const delta = normalCDF(d1);

            return { price, delta };
        }

        function calculateRealizedVol(prices) {
            const returns = [];
            for (let i = 1; i < prices.length; i++) {
                returns.push(Math.log(prices[i] / prices[i - 1]));
            }

            const variance = returns.reduce((sum, r) => sum + r * r, 0) / returns.length;
            const periodsPerYear = 365 * 24 * 6; // 10-minute intervals
            return Math.sqrt(variance * periodsPerYear);
        }

        // Run calculation
        function runDemo() {
            const initialSpot = spotData[0];
            const finalSpot = spotData[spotData.length - 1];
            const strike = 1.1000;
            const impliedVol = 0.10; // 10%
            const T = 1 / 365; // 1 day
            const notionalUSD = 100000000;
            const notionalEUR = notionalUSD / initialSpot;

            // Calculate realized vol
            const realizedVol = calculateRealizedVol(spotData);

            // Initial option
            const initialOption = blackScholesCall(initialSpot, strike, T, impliedVol);
            const premium = initialOption.price * notionalEUR;

            // Delta hedge simulation
            let cumulativeHedgePnL = 0;
            let deltaPosition = initialOption.delta * notionalEUR;
            let prevSpot = initialSpot;

            for (let i = 1; i < spotData.length; i++) {
                const currentSpot = spotData[i];
                const timeElapsed = i / spotData.length;
                const timeRemaining = Math.max(T * (1 - timeElapsed), 0);

                // Hedge P&L
                const hedgePnL = -deltaPosition * (currentSpot - prevSpot);
                cumulativeHedgePnL += hedgePnL;

                // Update delta
                if (timeRemaining > 0) {
                    const currentOption = blackScholesCall(currentSpot, strike, timeRemaining, impliedVol);
                    deltaPosition = currentOption.delta * notionalEUR;
                } else {
                    deltaPosition = 0;
                }

                prevSpot = currentSpot;
            }

            // Final intrinsic
            const intrinsic = Math.max(finalSpot - strike, 0) * notionalEUR;
            const totalPnL = -premium + cumulativeHedgePnL + intrinsic;

            // Display results
            const resultsHTML = `
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="label">Premium Paid</div>
                        <div class="big-number pnl-negative">$${premium.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
                    </div>
                    <div class="summary-card">
                        <div class="label">Hedge P&L</div>
                        <div class="big-number ${cumulativeHedgePnL >= 0 ? 'pnl-positive' : 'pnl-negative'}">
                            $${cumulativeHedgePnL.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="label">Intrinsic Value</div>
                        <div class="big-number pnl-positive">$${intrinsic.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
                    </div>
                    <div class="summary-card">
                        <div class="label">Total P&L</div>
                        <div class="big-number ${totalPnL >= 0 ? 'pnl-positive' : 'pnl-negative'}">
                            $${totalPnL.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}
                        </div>
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Initial Spot</td>
                            <td>${initialSpot.toFixed(4)}</td>
                        </tr>
                        <tr>
                            <td>Final Spot</td>
                            <td>${finalSpot.toFixed(4)}</td>
                        </tr>
                        <tr>
                            <td>Strike</td>
                            <td>${strike.toFixed(4)}</td>
                        </tr>
                        <tr>
                            <td>Option Type</td>
                            <td>Call</td>
                        </tr>
                        <tr>
                            <td>Time to Expiry</td>
                            <td>24 hours (1 day)</td>
                        </tr>
                        <tr>
                            <td>Hedge Frequency</td>
                            <td>10 minutes (${spotData.length} rehedges)</td>
                        </tr>
                        <tr>
                            <td>Notional</td>
                            <td>$${notionalUSD.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} (${notionalEUR.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} EUR)</td>
                        </tr>
                        <tr>
                            <td><strong>Implied Volatility</strong></td>
                            <td><strong>${(impliedVol * 100).toFixed(2)}%</strong></td>
                        </tr>
                        <tr>
                            <td><strong>Realized Volatility</strong></td>
                            <td><strong>${(realizedVol * 100).toFixed(2)}%</strong></td>
                        </tr>
                        <tr>
                            <td><strong>Vol Difference</strong></td>
                            <td><strong class="${realizedVol > impliedVol ? 'pnl-positive' : 'pnl-negative'}">
                                ${((realizedVol - impliedVol) * 100).toFixed(2)}%
                            </strong></td>
                        </tr>
                    </tbody>
                </table>

                <h3>üí° Interpretation:</h3>
                <div class="info-box">
                    ${totalPnL >= 0
                        ? '<strong>‚úÖ Profitable Trade</strong><br>The option buyer made money. '
                        : '<strong>‚ùå Loss on Trade</strong><br>The option buyer lost money. '}
                    ${realizedVol > impliedVol
                        ? 'Realized volatility was higher than implied, '
                        : 'Realized volatility was lower than implied, '}
                    ${totalPnL >= 0 && realizedVol > impliedVol
                        ? 'and the spot oscillated near the strike (high gamma region), generating hedge profits.'
                        : totalPnL < 0 && realizedVol > impliedVol
                        ? 'but spot moved away from the strike, making hedging less effective.'
                        : totalPnL >= 0 && realizedVol < impliedVol
                        ? 'but the option ended in-the-money with intrinsic value exceeding the premium.'
                        : 'resulting in a loss as the premium exceeded the final value.'}
                </div>

                <h3>üî¢ P&L Breakdown:</h3>
                <pre>Total P&L = -Premium + Hedge P&L + Intrinsic Value
          = -$${premium.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} + $${cumulativeHedgePnL.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} + $${intrinsic.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}
          = $${totalPnL.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</pre>
            `;

            document.getElementById('calculationResults').innerHTML = resultsHTML;
        }

        // Run on page load
        window.onload = runDemo;
    </script>
</body>
</html>
